BEGIN;
DROP TABLE IF EXISTS "card_has_tag" CASCADE;
DROP TABLE IF EXISTS "list" CASCADE;
DROP TABLE IF EXISTS "card" CASCADE;
DROP TABLE IF EXISTS "tag" CASCADE;

CREATE TABLE IF NOT EXISTS "list"(
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"name" TEXT NOT NULL,
"position" INTEGER DEFAULT 0,
"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updated_at" TIMESTAMPTZ
);
CREATE TABLE IF NOT EXISTS "card"(
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"name" TEXT NOT NULL,
"id_list" INTEGER NOT NULL REFERENCES "list"("id") ON DELETE CASCADE, 
"content" TEXT,
"position" INTEGER DEFAULT 0,
"color" TEXT,
"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updated_at" TIMESTAMPTZ
);
CREATE TABLE IF NOT EXISTS "tag"(
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"name" TEXT NOT NULL,
"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updated_at" TIMESTAMPTZ
);

CREATE TABLE IF NOT EXISTS "card_has_tag"(
"id" INTEGER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
"id_card" INTEGER REFERENCES "card"("id") ON DELETE CASCADE,
"id_tag" INTEGER REFERENCES "tag"("id") ON DELETE CASCADE,
"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updated_at" TIMESTAMPTZ,

-- contrainte d'unicit√©
UNIQUE("id_card","id_tag")
);

COMMIT;